---
description: 仕様を実際に固定するテストを書くワークフロー
---

# Kotlin Specification Testing Workflow

このワークフローは、定義された仕様（KDoc）をテストコードによって「事実」として固定する手順を規定します。

## 1. 仕様に基づくテストの作成

シグネチャとKDocのみを根拠にテストを記述します。実装の詳細を想定してはいけません。

- **テストフレームワーク**: `Kotest` を使用してください。
    - `FunSpec`を使用し、ネストを活用して仕様を整理する。
    - 環境制約でネストが使えない場合、// region <region>と//endregionを用いて整理してください。
- **検証内容**:
    - **代表値**: 典型的な入力に対する期待される出力。
    - **境界値・空**: 型別チェックリストに基づき、エッジケース（0, 空文字, 空リストなど）を検証する。
    - **例外**: `@throws` に記載された条件で正しく例外が発生することを確認する。
    - **副作用**: 観測可能な変化（I/O, 状態更新）がある場合、その事実を検証する。
- **Dependency Injection**:
    - 外部要因（時刻、乱数、ファイルシステム）が関わる場合は、DI可能な設計にし、テストが決定論的になるようにしてください。

## 2. Red（テスト失敗）の確認

実装を始める前に、必ずテストが期待通りに失敗することを確認します。
テスト方法： `./gradlew check`

- 少なくとも1つのテストが失敗することを確認してください。
- 失敗の理由が「未実装 (`TODO()`)」または「期待される例外の欠如」であることを確認してください。
- テスト自体の構文エラーやアサーションの誤りで落ちていないことを確認してください。

**注意**: もしテストがこの段階でパスしてしまった場合は、次の可能性があるため、原因を特定するまで次へ進んではいけません。
- テストが対象を正しく呼んでいない
- アサーションが存在しない
- 中身が先に実装されてしまっている
